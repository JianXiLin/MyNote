#

## 1. é…ç½®æ–‡ä»¶

1. äºŒè¿›åˆ¶æ—¥å¿— log-bin
2. é”™è¯¯æ—¥å¿— log-error
3. æ…¢æŸ¥è¯¢æ—¥å¿— log
4. æ•°æ®æ–‡ä»¶
    `/var/lib/mysql` -- æ¯ä¸ªæ–‡ä»¶å¤¹å¯¹åº”ä¸€ä¸ªæ•°æ®åº“
5. é…ç½®æ–‡ä»¶
    /etc/my.cnf

## 2. å­˜å‚¨å¼•æ“

### 2.1. ä½œç”¨

è´Ÿè´£æ•°æ®çš„å­˜å‚¨å’Œæå–

### 2.2. MyISAM ä¸ InnoDB

||MyISAM|InnoDB|
|-|-|-|
|ä¸»å¤–é”®|âŒ|âœ”|
|äº‹åŠ¡|âŒ|âœ”|
|è¡Œé”|âŒï¼ˆè¡¨é”ï¼‰|âœ”|
|ç¼“å­˜|ç´¢å¼•|ç´¢å¼•+æ•°æ®|
|ç´¢å¼•å®ç°|B-tree|B+tree|
|ç‰¹ç‚¹|è¡¨å ç”¨ç©ºé—´å°ï¼Œ`æ€§èƒ½`é«˜<br/>`ç³»ç»Ÿè¡¨`é»˜è®¤ä½¿ç”¨|è¡¨å ç”¨ç©ºé—´å¤§ï¼Œå`äº‹åŠ¡`<br/>`ç”¨æˆ·è¡¨`é»˜è®¤ä½¿ç”¨|

## 3. æŸ¥è¯¢SQLçš„æ‰§è¡Œé¡ºåº

ç¼–å†™é¡ºåºï¼š

```sql
select distinct <select_list>
from XX
join <t> on <condition>
where <condition>
group by <list>
having <condition>
order by <condition>
limit <number>
```

æ‰§è¡Œé¡ºåºå¦‚ä¸‹å›¾çš„åºå·æ‰€ç¤ºï¼š

![mysql/20200825153233](https://jianxi-md-pics.oss-cn-beijing.aliyuncs.com/note-md-imgs/mysql/20200825153233.png?x-oss-process=image/resize,p_100/sharpen,100)

![sql/20200825160336](https://jianxi-md-pics.oss-cn-beijing.aliyuncs.com/note-md-imgs/sql/20200825160336.png?x-oss-process=image/resize,p_100/sharpen,100)

## 4. ç´¢å¼•

### 4.1. å®šä¹‰

ç´¢å¼•æ˜¯æ•°æ®åº“ä¸­å®ç°ç‰¹å®šæœç´¢ç®—æ³•çš„æ•°æ®ç»“æ„ï¼Œå¯ç†è§£ä¸º`æ’å¥½åºçš„ã€ç”¨äºæŸ¥æ‰¾çš„æ•°æ®ç»“æ„`

### 4.2. ä¼˜ç¼ºç‚¹

ğŸ”¹ ä¼˜ç‚¹

æé«˜æœç´¢æ•ˆç‡ï¼Œé™ä½æ’åºæˆæœ¬

ğŸ”¹ ç¼ºç‚¹

1. ç´¢å¼•éœ€å æ®ç©ºé—´ï¼ˆä¹Ÿæ˜¯ä¸€ä¸ªæ•°æ®åº“è¡¨ï¼‰
2. è¡¨çš„æ›´æ–°å—å½±å“ï¼Œæ›´æ–°é€Ÿåº¦å˜æ…¢ã€‚updateã€deleteã€insertæ¯æ¬¡æ›´æ–°è¡¨ï¼Œéƒ½éœ€è¦ç»´æŠ¤ç´¢å¼•è¡¨ã€‚

### 4.3. ç´¢å¼•çš„åŸºæœ¬è¯­æ³•

#### 4.3.1. åˆ›å»ºç´¢å¼•

```sql
-- æ–¹å¼ä¸€
CREATE INDEX indexName ON table_name (column_name)
-- æ–¹å¼äºŒ
ALTER table table_name ADD  [UNIQUE]  INDEX [indexName] ON columnname(length)
-- æ–¹å¼ä¸‰
CREATE TABLE mytable(
    ...
    INDEX [indexName] (username(length))  
);  
```

#### 4.3.2. ä¿®æ”¹ç´¢å¼•

```sql
ALTER table table_name ADD INDEX indexName(columnName)
```

#### 4.3.3. åˆ é™¤ç´¢å¼•

```sql
DROP INDEX [indexName] ON table_name
```

#### 4.3.4. æŸ¥çœ‹ç´¢å¼•

```sql
SHOW INDEX FROM table_name\G
```

### 4.4 ç´¢å¼•ç±»å‹

#### 4.4.1 ä¸»é”®ç´¢å¼•

åˆ›å»ºä¸»é”®æ—¶ï¼Œå»ºç«‹çš„ç´¢å¼•

è¯­æ³•ï¼š`primary key(colunmer_name)`

#### 4.4.2 å”¯ä¸€ç´¢å¼•

ä¸€ä¸ªç´¢å¼•å¯¹åº”ä¸€åˆ—ï¼Œä¸”åˆ—ä¸­æ•°æ®ä¸èƒ½é‡å¤ï¼Œï¼ˆnullé™¤å¤–ï¼‰

==TODO: é—®é¢˜ï¼šnullæ˜¯å¦å¯é‡å¤ï¼Ÿ==

è¯­æ³•ï¼š`unique (~)`

#### 4.4.3 å•å€¼ç´¢å¼•

ä¸€ä¸ªç´¢å¼•å¯¹åº”ä¸€åˆ—
è¯­æ³•: `key (~)`

#### 4.4.5 å¤åˆç´¢å¼•

ä¸€ä¸ªç´¢å¼•å¯¹åº”å¤šåˆ—
è¯­æ³•: `key (colnumer,colnumer...)`

### 4.5 ç´¢å¼•çš„ä½¿ç”¨åœºæ™¯

æ¨èä½¿ç”¨åœºæ™¯ï¼š

1. ä¸»é”®
2. å¤–é”®
3. whereè¯­å¥
4. æ’åºï¼ˆorder byï¼‰
5. åˆ†ç»„ï¼ˆgroup byï¼‰
6. ç»Ÿè®¡

é¿å…ä½¿ç”¨çš„åœºæ™¯ï¼›

1. æ•°æ®é‡å°
2. è¡¨æ›´æ–°é¢‘ç¹
3. æ•°æ®é‡å¤æ€§é«˜ï¼Œæ¯”å¦‚åªæœ‰ä¸¤ä¸ªå€¼ï¼ˆtrueã€falseï¼‰
==TODO: 4. Whereæ¡ä»¶é‡Œç”¨ä¸åˆ°çš„å­—æ®µä¸åˆ›å»ºç´¢å¼•==

### 4.6 ç´¢å¼•åº•å±‚ç»“æ„

TODO: æ€»ç»“ç´¢å¼•æ•°æ®ç»“æ„

### 4.7 Explainå‘½ä»¤

#### 4.7.1 ä½œç”¨

Explainæä¾›è§£æsqlè¯­å¥çš„æ‰§è¡Œä¿¡æ¯ï¼Œæ ¹æ®è¯¥ä¿¡æ¯å¯å¯¹è¯­å¥è¿›è¡Œæ€§èƒ½ä¼˜åŒ–ã€‚

è¯­æ³•ï¼š `explain <sqlè¯­å¥>`

#### 4.7.2 ä½¿ç”¨ç»“æœ

è¾“å‡ºç»“æœï¼š

##### id

id ä¸ºsqlè¯­å¥æ®µæ‰§è¡Œé¡ºåº,`idå€¼è¶Šå¤§ï¼Œä¼˜å…ˆçº§è¶Šé«˜`ï¼Œè¶Šå…ˆæ‰§è¡Œ,`ç›¸åŒåˆ™ä»ä¸Šè‡³ä¸‹`é¡ºåºæ‰§è¡Œ

`åŒçº§æŸ¥è¯¢,idå€¼ç›¸åŒ. å­æŸ¥è¯¢,idå€¼ç´¯åŠ .`

ğŸ”¹ æ— å­æŸ¥è¯¢

```sql
-- SQLè¯­å¥
EXPLAIN SELECT *
FROM t1
JOIN t2 ON t1.id = t2.id
WHERE t1.`id` < 1000
ORDER BY t1.`id` DESC
LIMIT 1, 10

-- ç»“æœ
+----+-------------+-------+------------+--------+---------------+---------+---------+-----------------+------+----------+-------------+
| id | select_type | table | partitions | type   | possible_keys | key     | key_len | ref             | rows | filtered | Extra       |
+----+-------------+-------+------------+--------+---------------+---------+---------+-----------------+------+----------+-------------+
| 1  | SIMPLE      | t1    | <null>     | range  | PRIMARY       | PRIMARY | 4       | <null>          | 379  | 100.0    | Using where |
| 1  | SIMPLE      | t2    | <null>     | eq_ref | PRIMARY       | PRIMARY | 4       | myExplain.t1.id | 1    | 100.0    | <null>      |
+----+-------------+-------+------------+--------+---------------+---------+---------+-----------------+------+----------+-------------+

```

ğŸ”¹ å«å­æŸ¥è¯¢

```sql
-- SQLè¯­å¥
explain
select * from t1
where t1.id =  (select id from t2 where t2.id=10)


-- ç»“æœ
+----+-------------+-------+------------+-------+---------------+---------+---------+-------+------+----------+-------------+
| id | select_type | table | partitions | type  | possible_keys | key     | key_len | ref   | rows | filtered | Extra       |
+----+-------------+-------+------------+-------+---------------+---------+---------+-------+------+----------+-------------+
| 1  | PRIMARY     | t1    | <null>     | const | PRIMARY       | PRIMARY | 4       | const | 1    | 100.0    | <null>      |
| 2  | SUBQUERY    | t2    | <null>     | const | PRIMARY       | PRIMARY | 4       | const | 1    | 100.0    | Using index |
+----+-------------+-------+------------+-------+---------------+---------+---------+-------+------+----------+-------------+

```

###### select_type

ğŸ”¹ <b>simple</b>

`ç®€å•çš„sqlè¯­å¥`,ä¸åŒ…å«å­æŸ¥è¯¢å’Œunionè”åˆæŸ¥è¯¢

ğŸ”¹ <b>primary</b>

åŒ…å«å­æŸ¥è¯¢è¯­å¥çš„`æœ€å¤–å±‚è¯­å¥`

ğŸ”¹ <b>derived (è¡ç”Ÿ) </b>

`å­æŸ¥è¯¢`, ä½äº`from`ä¸­

ğŸ”¹ <b>subquery</b>

`å­æŸ¥è¯¢`,ä½äº`select`æˆ–`where`ä¸­,`ä»…æœ‰ä¸€ä¸ªç»“æœ`

ğŸ”¹ <b>dependent subquery</b>

`å­æŸ¥è¯¢`,ä½äº`select`æˆ–`where`ä¸­,`å«å¤šä¸ªç»“æœ`

ğŸ”¹ <b>uncacheable subquery</b>

`å­æŸ¥è¯¢`,æ— æ³•è¢«ç¼“å­˜

ğŸ”¹ <b>union</b>

union ä¸­çš„ç¬¬äºŒä¸ªselect

ğŸ”¹ <b>union result</b>

union çš„ç»“æœ

##### table

è¯­å¥æ‰€æŸ¥è¯¢åˆ°è¡¨æ ¼åç§°

##### type

æŸ¥è¯¢ç»“æœç±»å‹

ğŸ”¹<b> system </b>

æŸ¥è¯¢åˆ°è¡¨,åªæœ‰ä¸€è¡Œæ•°æ®

ğŸ”¹<b> const </b>

æŸ¥è¯¢ç»“æœåªæœ‰ä¸€è¡Œæ•°æ®

ğŸ”¹<b> eq_ref </b>



ğŸ”¹<b> ref </b>

ğŸ”¹<b> range </b>

ğŸ”¹<b> index </b>

ğŸ”¹<b> all </b>

ğŸ”¹<b> index_merge </b>

ğŸ”¹<b> ref_or_null </b>

ğŸ”¹<b> index_subquery </b>

ğŸ”¹<b> unique_subquery </b>
