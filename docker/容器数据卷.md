#

## 1. ä»€ä¹ˆæ˜¯å®¹å™¨æ•°æ®å·

dockerä¸­å®ç°æ•°æ®æŒä¹…åŒ–çš„æ–¹æ¡ˆã€‚å°†å®¹å™¨å†…çš„æ–‡ä»¶å…³è”åˆ°ä¸»æœºï¼ˆå®¿ä¸»æœºï¼‰çš„æ–‡ä»¶ï¼Œå¯å®ç°å®¹å™¨æ•°æ®æŒä¹…åŒ–ä¸åŒæ­¥æ“ä½œä»¥åŠå…±äº«æ•°æ®ã€‚

## 2. åŸºæœ¬ä½¿ç”¨ï¼ˆå®ç°æ–‡ä»¶æ˜ å°„--æŒ‚è½½ï¼‰

### 2.1. æ–¹å¼ä¸€ï¼šä½¿ç”¨runå‘½ä»¤ -v

<b>docker run -it -v ä¸»æœºç›®å½•:å®¹å™¨ç›®å½• å®¹å™¨å</b>

å°†å®¹å™¨ç›®å½•æ˜ å°„åˆ°ä¸»æœºç›®å½•åï¼Œå®¹å™¨ç›®å½•å°†ä¸ä¸»æœºç›®å½•è¿›è¡ŒåŒæ­¥æ“ä½œï¼Œä»¥æ­¤å®ç°æ•°æ®åŒæ­¥ã€‚åŒæ—¶ä¸»æœºç›®å½•å†…å®¹ä¿®æ”¹ï¼Œå®¹å™¨å†…å®¹ä¹Ÿå°†å‘ç”Ÿä¿®æ”¹ï¼Œå®ç°äº†åŒå‘ç»‘å®šã€‚

```shell
// è®¾ç½®å®¹å™¨çš„æ˜ å°„æ–‡ä»¶
docker run -it -v /home/test:/home centos /bin/bash
// æŸ¥çœ‹æ˜ å°„ä¿¡æ¯
docker inspect 22b642f532bb

// inspectä¸­çš„æ˜ å°„æ–‡ä»¶é…ç½®
 "Mounts": [
            {
                "Type": "bind",
                "Source": "/home/test", //ä¸»æœºç›®å½•
                "Destination": "/home", //dockerå®¹å™¨ç›®å½•
                "Mode": "",
                "RW": true,
                "Propagation": "rprivate"
            }
        ],

```

#### æ¡ˆä¾‹ï¼ˆéƒ¨ç½²mysqlï¼‰

```shell

# 1.ä¸‹è½½mysql
docker pull mysql:5.7

# 2.å¯åŠ¨ã€é…ç½®mysql
#   - æ˜ å°„ç«¯å£
#   - æ˜ å°„æ–‡ä»¶
#   - è®¾ç½®å¯†ç 
docker run -d -p 3310:3306 \
-v /home/mysql/conf:/etc/mysql/conf.d \
-v /home/mysql/data:/var/lib/mysql \
-e MYSQL_ROOT_PASSWORD=123456 \
--name mysql01 mysql:5.7

# 3.æµ‹è¯•ï¼š
# è¿œç¨‹è¿æ¥å¹¶åˆ›å»ºæ•°æ®åº“
# ä¸»æœº/homeã€‚mysql/dataä¹Ÿä¼šç”Ÿæˆç°æœ‰çš„æ•°æ®åº“æ–‡ä»¶

# 4.åˆ é™¤dockerä¸­çš„æ•°æ®åº“å®¹å™¨ï¼Œä¸»æœºä¸­çš„æ•°æ®åº“æ•°æ®ä»ä¼šå­˜åœ¨
docker rm -f fb84a9afc5f3

```

### 2.2. æ–¹å¼äºŒï¼šä½¿ç”¨DockerFile

åœ¨æ–‡ä»¶ä¸­VOLUME å°†æŒ‡å®šè¯¥å®¹å™¨ä¸­å°†æŒ‚è½½çš„è·¯å¾„ï¼Œè‹¥è·¯å¾„ä¸å­˜åœ¨åˆ™ä¼šè‡ªåŠ¨åˆ›å»ºã€‚è‹¥åªå†™å®¹å™¨æŒ‚è½½çš„è·¯å¾„ï¼Œåˆ™ä¸ºåŒ¿åæŒ‚è½½ã€‚

```shell
# 1.ç¼–å†™Dockerfile
vi Dockerfile
-----------Dockerfileå†…å®¹------------
FROM centos
VOLUME ["volume01","volume02"]
CMD echo "--END--"
CMD /bin.bash
-----------------End------------------

# 2.åˆ›å»ºé•œåƒ
docker build -f /home/docker-demo-volume/dockerfile -t xi/centos:1.0 .

# 3.è¿è¡Œé•œåƒå¹¶è¿›å…¥
docker run -it d00e4595f1ae /bin/bash

# 4.æŸ¥çœ‹/volume01ä¸/volume02æ˜¯å¦å­˜åœ¨
ls
--------------------æ˜¾ç¤ºçš„å†…å®¹-------------------------
bin  dev  ......  tmp  usr  var  volume01 volume02
------------------------End---------------------------

```

## 3. æ•°æ®å·å‘½ä»¤ volume

<b>docker volume </b>

    create      Create a volume
    inspect     Display detailed information on one or more volumes
    ls          List volumes
    prune       Remove all unused local volumes
    rm          Remove one or more volumes

```shell
docker volume ls
docker volume inspect å·åç§°
```

## 4. å…·åæŒ‚è½½å’ŒåŒ¿åæŒ‚è½½

å…·åæŒ‚è½½ï¼šæŒ‡å®šæŒ‚è½½çš„å·çš„åç§°
åŒ¿åæŒ‚è½½ï¼šä¸æŒ‡å®šåç§°ï¼Œéšæœºç”Ÿæˆå·åç§°

ğŸ”¹ ä½¿ç”¨<b>docker run -v</b>æ¥å®ç°

åŒ¿åæŒ‚è½½ï¼š-v å®¹å™¨è·¯å¾„
å…·åæŒ‚è½½ï¼š-v å·å:å®¹å™¨è·¯å¾„
æŒ‡å®šæŒ‚è½½è·¯å¾„ï¼š -v ä¸»æœºè·¯å¾„:å®¹å™¨è·¯å¾„

> è®¾ç½®å®¹å™¨å¯¹å·çš„æƒé™
> -v ä¸»æœºè·¯å¾„|å·å : å®¹å™¨è·¯å¾„ : ro|rw
> &emsp;ro : read only
> &emsp;rw : read and write

```shell

# 1. åŒ¿åæŒ‚è½½nginxæ–‡ä»¶
docker run -d -P --name nginx01 -v /etc/nginx nginx
# æŸ¥çœ‹å·ä¿¡æ¯
docker volume inspect 3780b7c7663441ad015ac22235d7522175c
5ceeb02c05433df42b263f8aa4535

# 2. å…·åæŒ‚è½½nginxæ–‡ä»¶
docker run -d -P --name nginx02 -v nginx-v:/etc/nginx nginx
# æŸ¥çœ‹å·ä¿¡æ¯
docker volume inspect nginx-v

[
    {
        "CreatedAt": "2020-06-14T00:38:57+08:00",
        "Driver": "local",
        "Labels": null,
        "Mountpoint": "/var/lib/docker/volumes/nginx-v/_data",
        "Name": "nginx-v",
        "Options": null,
        "Scope": "local"
    }
]

```

ç”±volume inspectå¯çœ‹å‡ºï¼Œå½“ä¸æŒ‡å®šä¸»æœºè·¯å¾„æ—¶ï¼Œé»˜è®¤æŒ‚è½½çš„ç›®å½•ä¸º/var/lib/docker/volumes/ä¸å·ååŒåçš„æ–‡ä»¶å¤¹/_data

## 5. æ•°æ®å·å®¹å™¨

å½“æŸä¸ªå®¹å™¨å­˜åœ¨æ–‡ä»¶è¢«å¤šä¸ªå®¹å™¨æŒ‚è½½æ—¶ã€‚è¯¥å®¹å™¨åˆ™ä¸ºçˆ¶å®¹å™¨ï¼Œä¹Ÿå°±ä¸ºæ•°æ®å·å®¹å™¨ã€‚ä»¥æ­¤å®ç°å¤šä¸ªå®¹å™¨ä¹‹é—´çš„æ•°æ®å…±äº«ã€‚

ğŸ”¹ ä½¿ç”¨ <b>docker run --volumes-from </b>æ¥å®ç°

--volume-from æŒ‚è½½çš„å®¹å™¨å

ğŸ”¹ æ¡ˆä¾‹ï¼š
&emsp;å®ç°docker01ä½œä¸ºæ•°æ®å·å®¹å™¨ï¼Œdocker02ã€docker03æŒ‚è½½åˆ°å…¶ä¸­ã€‚

```shell

# å¼€å¯dockers01
docker run -it --name docker01 d00e4595f1ae /bin/bash

# å¯åŠ¨docker02ï¼Œå¹¶æŒ‚è½½åˆ°dockers01å®¹å™¨
docker run -it --name docker02 --volumes-from docker01 /bin/bash

# å¯åŠ¨docker03ï¼Œå¹¶æŒ‚è½½åˆ°docker01å®¹å™¨
docker run -it --name docker03 --volumes-from docker01 /bin/bash

```
> ä»¥ä¸‹å›¾ç‰‡ä¸­çš„volume01_ä¸»æœºã€volume01ã€_volume01ã€__volume01æ–‡ä»¶å¤¹åç§°éƒ½ä¸ºvolume01,è¿™é‡Œä¸ºäº†åŒºåˆ†,è€Œæ˜¾ç¤ºä¸åŒåç§°. volume02ä¹Ÿæ˜¯ä¸€æ ·.

```puml
@startuml

card volume01_ä¸»æœº
card volume02_ä¸»æœº

left to right direction
frame docker01(æ•°æ®å·å®¹å™¨){
card volume01
card volume02
}

frame docker02{
card _volume01
card _volume02
}
frame docker03{
card __volume01
card __volume02
}

volume01<-->_volume01
volume01<-->__volume01
volume02<-->_volume02
volume02<--->__volume02

volume01_ä¸»æœº<-->volume01
volume02_ä¸»æœº<-->volume02
@enduml
```

å½“åˆ é™¤æ•°æ®å·å®¹å™¨åï¼Œå…¶å­å®¹å™¨æŒ‚è½½åœ¨çˆ¶å®¹å™¨çš„å†…å®¹ä»å­˜åœ¨ã€‚
å½“æ‰€æœ‰å®¹å™¨éƒ½åˆ é™¤ã€å…³é—­åï¼Œç”±äºdocker01æ•°æ®å·å®¹å™¨åœ¨å¯åŠ¨æ—¶ï¼ŒæŒ‚è½½äº†ä¸»æœºï¼Œæ‰€ä»¥å·å†…å®¹åœ¨ä¸»æœºä»æœ‰ä¿ç•™ã€‚

```puml
@startuml
rectangle "åˆ é™¤æ‰æ•°æ®å·å®¹å™¨åçš„å†…å®¹" <<ä¸»æœº>> {
    card volume01_ä¸»æœº
    card volume02_ä¸»æœº

    frame docker02{
    card _volume01
    card _volume02
    }
    frame docker03{
    card __volume01
    card __volume02
    }

    volume01_ä¸»æœº<-->_volume01
    volume02_ä¸»æœº<-->_volume02
    volume01_ä¸»æœº<-->__volume01
    volume02_ä¸»æœº<-->__volume02
}
@enduml
```

```puml
@startuml
rectangle "æ‰€æœ‰å®¹å™¨åˆ é™¤åçš„å†…å®¹" <<ä¸»æœº>> {
    card volume01_ä¸»æœº
    card volume02_ä¸»æœº
}
@enduml
```
