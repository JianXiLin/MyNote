#

## 1.dockerç½‘ç»œæ¨¡å‹

dockerå®¹å™¨æ˜¯é€šè¿‡veth-pairæ¥å®ç°å®¹å™¨é—´çš„é€šä¿¡,ä½¿ç”¨æ¡¥æ¥æ¨¡å¼æ¥å®ç°.dockerå¯åŠ¨å,ä¸»æœºä¾¿æœ‰ä¸€ä¸ªåä¸ºdocker0çš„ç½‘å¡,å…¶å°†ä½œä¸ºå®¹å™¨é€šä¿¡çš„æ¡¥æ¢.docker0é€šè¿‡veth-pairæ¥
ä¸å®¹å™¨è™šæ‹Ÿç½‘ç»œé€šä¿¡,å†ä¸ä¸»æœºçš„eth0ç½‘å¡é€šä¿¡,ä»¥æ­¤å®ç°å®¹å™¨çš„é€šä¿¡.
![2020-06-15-10-53-48](./imgs/dockerç½‘ç»œ.md/2020-06-15-10-53-48.png)

## 2. å®¹å™¨é€šä¿¡

å®¹å™¨é—´çš„é€šä¿¡,éœ€è¦docker0æ¥è¿›è¡Œè½¬å‘.ä¸ºæ­¤,ä½¿ç”¨veth-pairè¿æ¥å,dockerä¼šç»™å®¹å™¨åˆ†é…ä¸€ä¸ªip.

### ğŸ’­ é—®é¢˜ä¸€ : ipå€¼ä¸ç¨³å®š

ä½¿ç”¨ipæ¥è¯·æ±‚å®¹å™¨å†…å®¹æ—¶,å½“å®¹å™¨è¢«åˆ†é…çš„ipå‘ç”Ÿæ”¹å˜,è¯·æ±‚urlä¹Ÿéœ€æ”¹å˜,å¦‚ä½•è§£å†³è¿™ä¸€é—®é¢˜?

#### è§£å†³æ–¹æ³• : ä½¿ç”¨--link

å¯¹äºè¯¥é—®é¢˜,dockerå¯ä½¿ç”¨å®¹å™¨åç§°æ¥ä¸å®¹å™¨ipè¿›è¡Œæ˜ å°„,å¤–éƒ¨å¼•ç”¨åªéœ€ä½¿ç”¨å®¹å™¨åç§°,æ— éœ€ä½¿ç”¨ip.
ğŸ”¹ å‘½ä»¤: <b>docker run --link å®¹å™¨åç§°</b>

ä½¿ç”¨--linkå,å°†åœ¨å®¹å™¨å†…çš„/etc/hostsæ–‡ä»¶ä¸­æ·»åŠ linkå®¹å™¨ipä¸linkå®¹å™¨åç§°æ˜ å°„çš„å†…å®¹.

æ¡ˆä¾‹:

```shell
# 1. å¯åŠ¨tomcat01å®¹å™¨,å¹¶æ·»åŠ tomcat02å®¹å™¨ipä¸å…¶åç§°çš„æ˜ å°„
docker run -d --name tomcat01 --link tomcat02 tomcat
# æ£€æŸ¥tomcat01å®¹å™¨ä¸­çš„hosts
docker exec -it tomcat01 cat /etc/hosts
---------tomcat01å®¹å™¨çš„/etc/hosts----------------
172.18.0.3	tomcat02 3e7188ad5609
172.18.0.2	5ec20623eeec
------------------------------------------------

# 2. å®¹å™¨tomcat01 ping å®¹å™¨tomcat02(172.18.0.3)
docker exec -it tomcat01 ping 172.18.0.3
# ç­‰ä»·äº
docker exec -it tomcat01 ping tomcat02

```

### ğŸ’­ é—®é¢˜äºŒ : --linkä½¿ç”¨å­˜åœ¨å±€é™

--link ä¸€æ¬¡åªèƒ½è®¾ç½®ä¸¤ä¸ªå®¹å™¨é—´å•å‘é€šä¿¡çš„å®¹å™¨åä¸ipçš„æ˜ å°„.

#### è§£å†³æ–¹æ³• : è‡ªå®šä¹‰ç½‘ç»œ

ä½¿ç”¨dockerè‡ªå®šä¹‰çš„ç½‘ç»œ,å°†ä¼šè‡ªåŠ¨ç»´æŠ¤å®¹å™¨ä¸å®¹å™¨è¢«åˆ†é…çš„ipçš„å…³ç³».å¼¥è¡¥äº†docker0çš„å±€é™æ€§(é»˜è®¤æ— æ³•é€šè¿‡å®¹å™¨åç§°è¿›è¡Œé€šä¿¡).

#### ç›¸å…³å‘½ä»¤

ğŸ”¹<b>docker network</b>

    ls          : æŸ¥çœ‹dockerç½‘ç»œåˆ—è¡¨
    inspect     : æŸ¥çœ‹å…ƒæ•°æ®
    rm          : åˆ é™¤dockerç½‘ç»œ
    create      : åˆ›å»ºdockerç½‘ç»œ

ğŸ”¹<b>docker run -net ç½‘ç»œæ¨¡å¼ </b>

æŒ‡å®šå®¹å™¨çš„ç½‘ç»œæ¨¡å¼,ä¸æŒ‡å®šæ—¶,é»˜è®¤ä¸ºbridge

```shell
docker run -d -P -net bridge tomcat
# ç­‰ä»·äº
docker run -d -P tomcat
```

>dockerä¸­çš„ç½‘ç»œæ¨¡å¼
&emsp;bridge  : æ¡¥æ¥æ¨¡å¼ (é»˜è®¤)
&emsp;none    : ä¸é…ç½®ç½‘ç»œ
&emsp;host    : ä¸å®¿ä¸»æœºå…±äº«ç½‘ç»œ
&emsp;container  : è¿é€šå®¹å™¨ç½‘ç»œ (å±€é™å¤§)

#### åˆ›å»ºè‡ªå®šä¹‰dockerç½‘ç»œå–ä»£--link

```shell
# è‡ªå®šä¹‰ç½‘ç»œ
# --driver  ç½‘ç»œæ¨¡å¼
# --subnet  å­ç½‘
# --gateway  ç½‘å…³
docker network create --driver bridge \
--subnet 192.168.0.0/16 \
--gateway 192.168.0.1 mynet

# æµ‹è¯•:åˆ›å»ºä¸¤ä¸ªå®¹å™¨ä½¿ç”¨è¯¥è‡ªå®šä¹‰ç½‘ç»œ
docker run -d --name tomcat_net_1 --net mynet tomcat
docker run -d --name tomcat_net_2 --net mynet tomcat

# tomcat_net_1 ping tomcat_net_2 (æ— éœ€ä½¿ç”¨ip)
docker exec tomcat_net_1 ping tomcat_net_2 #å¯pingé€š

```

## 3. è‡ªå®šä¹‰ç½‘ç»œ

é€šè¿‡dockeræ¥è‡ªå®šä¹‰ç½‘ç»œå¯ç”¨äºå–ä»£--linkæ¥å®ç°å®¹å™¨åç§°ä¸å…¶idçš„æ˜ å°„,å¦‚ç¬¬2ç‚¹æ‰€æåŠçš„å†…å®¹.
åŒæ—¶ä½¿ç”¨è‡ªå®šä¹‰ç½‘ç»œä¹Ÿå¯ä½¿ä¸åŒé›†ç¾¤çš„ç½‘ç»œåˆ†ç¦»,ä¿è¯é›†ç¾¤çš„å®‰å…¨ä¸å¥åº·.

#### ğŸ’­ å½“ä½¿ç”¨ä¸åŒé›†ç¾¤ä½¿ç”¨ä¸åŒç½‘ç»œå,ä¸åŒç½‘ç»œé—´åˆå¦‚ä½•é€šä¿¡

ä¸åŒç½‘ç»œä¸ºä¸åŒç½‘æ®µ,ç½‘å¡ä¹‹é—´æ— æ³•åœ¨ç›´æ¥è¿é€š.ä½†å¯¹äºé›†ç¾¤ç½‘ç»œä¸­çš„å®¹å™¨è€Œè¨€,å®¹å™¨å¯æ·»åŠ åˆ°ä¸åŒçš„ç½‘ç»œ,ä¹Ÿå°±æ˜¯ä¸€ä¸ªå®¹å™¨å¯æœ‰ä¸¤ä¸ªip,å¯å®ç°å®¹å™¨ä¸å¦ä¸€ä¸ªç½‘æ®µç½‘ç»œçš„è¿é€š.

#### ç›¸å…³å‘½ä»¤

<b>docker network connect ç½‘ç»œ å®¹å™¨</b>
å°†ä¸€ä¸ªå®¹å™¨åŠ å…¥åˆ°ç½‘ç»œä¸­

#### å®ç°ä¸åŒç½‘æ®µé—´é€šä¿¡

```shell
# å°†docker0ç½‘å¡ä¸‹çš„å®¹å™¨ æ·»åŠ åˆ°è‡ªå®šä¹‰ç½‘å¡mynet
# å®ç°è¯¥å®¹å™¨åˆ°mynetç½‘ç»œçš„é€šä¿¡
docker network connect mynet tomcat_1

# ç½‘å¡docker0ä¸‹çš„tomcat_1 ping ç½‘å¡mynetä¸‹çš„tomcat_net_1
docker exec -it tomcat_1 ping tomcat_net_1      #å¯pingé€š

```
