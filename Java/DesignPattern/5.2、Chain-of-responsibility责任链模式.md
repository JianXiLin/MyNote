# è´£ä»»é“¾æ¨¡å¼

## ä¸€ã€åŠŸèƒ½

&emsp;&emsp;è´£ä»»é“¾æ¨¡å¼æŒ‡çš„æ˜¯ï¼šå°†å¯¹åŒä¸€ä¸ªå†…å®¹çš„å¤šä¸ªå¤„ç†æ“ä½œæ‹†åˆ†ä¸ºå¤šä¸ªå¤„ç†è€…æ‰§è¡Œï¼Œå¹¶å°†å…¶ä¸²è”æˆä¸€æ¡æ‰§è¡Œé“¾ã€‚æ¯ä¸ªå¤„ç†è€…éƒ½æœ‰å…¶å¯¹åº”ã€ç‹¬ç«‹çš„èŒè´£ã€‚åœ¨å¤„ç†å†…å®¹æ—¶ï¼Œåˆ™é€šè¿‡è¿™æ¡è´£ä»»é“¾ï¼Œä¾æ¬¡è·å–å¤„ç†è€…çš„å¼•ç”¨ï¼Œå®Œæˆç›¸åº”çš„æ“ä½œã€‚

<t>è´£ä»»é“¾å¤„ç†æµç¨‹çš„ç»ˆæ­¢æ–¹å¼å¯åˆ†ä¸ºä¸¤ç§ï¼š</t>

1. å®Œæˆä¸€æ¬¡å¤„ç†æ“ä½œï¼ˆæˆåŠŸ|å¤±è´¥ï¼‰ï¼Œåˆ™ç»ˆæ­¢ã€‚
2. å¤„ç†å®Œæ‰€æœ‰çš„å¤„ç†æ“ä½œã€‚
    å¦‚ä¸‹å›¾ä¸­ï¼Œä¸€æ¡¶æ°´ï¼ˆè¢«å¤„ç†çš„å†…å®¹ï¼‰åœ¨é“¾ä¸Šçš„äººç‰©ï¼ˆå¤„ç†è€…ï¼‰ä¹‹é—´ä¾æ¬¡ä¼ é€’ã€å€’æ°´ï¼ˆå¤„ç†å†…å®¹ï¼‰ï¼Œæ— è®ºæ˜¯å¦å¯ä»¥å€’æ°´ï¼ˆèƒ½å¦è¢«å¤„ç†ï¼‰éƒ½å°†ä¼ é€’ç»™ä¸‹ä¸€ä½å¤„ç†è€…ï¼Œç›´åˆ°æ‰€æœ‰å¤„ç†è€…éƒ½å¤„ç†äº†ä¸€éã€‚

![è´£ä»»é“¾](https://refactoringguru.cn/images/patterns/content/chain-of-responsibility/chain-of-responsibility.png)

æ­¤å›¾ç‰‡æ¥æºï¼šğŸ‘‰[refactoringguru.cn](https://refactoringguru.cn/design-patterns/chain-of-responsibility)

## äºŒã€å®ç°

åœ¨å®ç°é“¾ä¸Šå„èŠ‚ç‚¹çš„å…³ç³»ä¸Šï¼Œå¯åˆ†ä¸ºæ•°ç»„æˆ–é“¾è¡¨ä¸¤ç§å®ç°ã€‚

### æ–¹å¼ä¸€ï¼šæ•°ç»„å­˜å‚¨èŠ‚ç‚¹å…³ç³»

<!-- 
```puml
    skinparam backgroundColor Beige
    Interface Handler{
        do()
    }

    class Handler1{
        do()
    }
    note left : å¤„ç†å™¨1

    class Handler2{
        do()
    }

    class Handler3{
        do()
    }

    class HandlerChain{
        Handler[] handlers;
        do();
    }
    note left : å¤„ç†å™¨ç®¡ç†ç±»
    note left of HandlerChain
        void do(){
            for(handler:handlers){
                handler.do();
            }
        }
    end note
    class main

    Handler1 ..|> Handler
    Handler2 ..|> Handler
    Handler3 ..|> Handler

    Handler --o HandlerChain
    main -> HandlerChain : è°ƒç”¨
```  -->

![/è´£ä»»é“¾æ¨¡å¼/20210506003231](https://jianxi-md-pics.oss-cn-beijing.aliyuncs.com/note-md-imgs//è´£ä»»é“¾æ¨¡å¼/20210506003231.png?x-oss-process=image/resize,p_100/sharpen,50)

### æ–¹å¼äºŒï¼šé“¾è¡¨å½¢æˆèŠ‚ç‚¹å…³ç³»

<!-- ```puml
    skinparam backgroundColor Beige
    Interface Handler{
        getNext();
        setNext(Handler handler);
        do();
    }

    class Handler1{
        getNext()
        setNext(-)
        do()
    }
    note left : å¤„ç†å™¨1

    class Handler2{
        getNext()
        setNext(-)
        do()
    }

    class Handler3{
        getNext()
        setNext(-)
        do()
    }

    class HandlerChain{
        Handler first;
        do();
    }
    note left : å¤„ç†å™¨ç®¡ç†ç±»
    note left of HandlerChain
        void do(first){
            first.do();
            do(first.getNext()); //é€’å½’
        }
    end note
    class main

    Handler1 ..|> Handler
    Handler2 ..|> Handler
    Handler3 ..|> Handler

    Handler --o HandlerChain
    main -> HandlerChain : è°ƒç”¨
``` -->

![è´£ä»»é“¾/20210514003751](https://jianxi-md-pics.oss-cn-beijing.aliyuncs.com/note-md-imgs/è´£ä»»é“¾/20210514003751.png?x-oss-process=image/resize,p_100/sharpen,50)

## ä¸‰ã€æ¡ˆä¾‹

### 1, ç®€æ˜“è¿‡æ»¤å™¨

&emsp;&emsp;å‡è®¾ï¼Œéœ€è¦å¯¹ä¸€ä¸ªå†…å®¹è¿›è¡Œè¿‡æ»¤ã€‚æˆ‘ä»¬å¯å°†è¿‡æ»¤çš„æ“ä½œæ‹†åˆ†ä¸ºå¤šä¸ªè¿‡æ»¤æ“ä½œï¼ˆè¿‡æ»¤å™¨xxxFilterï¼‰ã€‚å„ä¸ªè¿‡æ»¤å™¨å®ç°å¯¹åº”çš„è¿‡æ»¤æ“ä½œï¼ˆdoFilterï¼‰ï¼Œå†é€šè¿‡è¿‡æ»¤é“¾ï¼ˆXXFilterChainï¼‰æ¥å°†å„ä¸ªè¿‡æ»¤å™¨è”ç³»ã€ä¸²è”èµ·æ¥ï¼Œè¿›è¡Œè¿‡æ»¤æ“ä½œã€‚é€šè¿‡è¿™ç§æ¨¡å¼ï¼Œæˆ‘ä»¬å¯åœ¨åç»­æ·»åŠ è¿‡æ»¤æ“ä½œæ—¶ï¼Œå¯æ— éœ€ä¿®æ”¹åŸæœ‰è¿‡æ»¤å™¨ç±»ï¼Œè¾¾åˆ°ä¸€ä¸ªä»£ç è§£è€¦åˆçš„ç›®çš„ã€‚

<b type="h">å¯¹åº”ç±»å›¾</b>
<!-- ![2021-05-13-23-49-42](./imgs/5.2ã€Chain-of-responsibilityè´£ä»»é“¾æ¨¡å¼.md/2021-05-13-23-49-42.png) -->

![è´£ä»»é“¾/20210514003913](https://jianxi-md-pics.oss-cn-beijing.aliyuncs.com/note-md-imgs/è´£ä»»é“¾/20210514003913.png?x-oss-process=image/resize,p_100/sharpen,50)

<b type="h">å¯¹åº”æ“ä½œçš„æµç¨‹å›¾</b>

<!-- <center>
    <img src=".\imgs\5.2ã€Chain-of-responsibilityè´£ä»»é“¾æ¨¡å¼.md\image-20200314134439463.png" alt="image-20200314134439463" style="zoom: 80%;" />
</center> -->

![è´£ä»»é“¾/20210514004017](https://jianxi-md-pics.oss-cn-beijing.aliyuncs.com/note-md-imgs/è´£ä»»é“¾/20210514004017.png?x-oss-process=image/resize,p_100/sharpen,50)

&emsp;&emsp;åŒæ—¶æˆ‘ä»¬ä¹Ÿå¯ä»¥å°†è¿‡æ»¤é“¾å®ç°ä¸è¿‡æ»¤å™¨ä¸€è‡´çš„æ¥å£ï¼Œå¯å°†è¿‡æ»¤é“¾ä½œä¸ºä¸€ä¸ªæ–°çš„è¿‡æ»¤å™¨ï¼Œå¹¶ç»„åˆåˆ°æ–°çš„è¿‡æ»¤é“¾ä¸­ã€‚è¿™æ ·ä¹Ÿå¯æé«˜è¿‡æ»¤å™¨çš„å¤ç”¨æ€§ã€‚

<b type="h">å¤šè¿‡æ»¤é“¾çš„ç±»å›¾</b>

<!-- <center>
    <img src=".\imgs\5.2ã€Chain-of-responsibilityè´£ä»»é“¾æ¨¡å¼.md\image-20200314134841773.png"/>
</center> -->

![è´£ä»»é“¾/20210514004104](https://jianxi-md-pics.oss-cn-beijing.aliyuncs.com/note-md-imgs/è´£ä»»é“¾/20210514004104.png?x-oss-process=image/resize,p_100/sharpen,50)

### 2. Servlet ä¸­ Filter

#### è¯´æ˜

Servletçš„Filterè´£ä»»é“¾å®ç°æ–¹å¼æ˜¯é‡‡ç”¨é€’å½’çš„æ–¹å¼å®ç°ï¼Œé€šè¿‡
ç”±äº Servlet ä¸­çš„åŒä¸€ä¸ªFilteréœ€è¦å¤„ç† requestå’Œresponseï¼Œä¸”å¤„ç†request å’Œ response çš„Filteræ‰§è¡Œé¡ºåºç›¸åã€‚

#### å¤„ç†æ–¹æ¡ˆ

ä¸åŒäºæ•°ç»„å®ç°æ–¹å¼çš„è´£ä»»é“¾ï¼ŒFilterChainä¸ç›´æ¥éå†Filteræ•°ç»„ï¼Œæ¥é¡ºåºæ‰§è¡ŒFilterã€‚è€Œæ˜¯é€šè¿‡è®°å½•è´£ä»»é“¾çš„æ‰§è¡Œä½ç½®ï¼ŒæŒ‡å‘ä¸‹ä¸€ä¸ªå°†æ‰§è¡Œçš„Filterï¼Œæ¯ä¸ªFilterä¼ å…¥FilterChainçš„å¼•ç”¨ï¼Œä»¥è°ƒç”¨ä¸‹ä¸€ä¸ªFilterã€‚

==Filter.doFilter(request,response,FilterChain)==

1.Filterçš„æ‰§è¡Œé¡ºåºä¸ç”±FilterChainéå†Filtersæ§åˆ¶ã€‚
2. FilterChain ä¸­è®¾ç½®å˜é‡ï¼ŒæŒ‡å‘éœ€æŒ‡å‘çš„ä¸‹ä¸€ä¸ªFilterï¼ˆé»˜è®¤0ï¼‰ã€‚
3.é€šè¿‡FilterChainçš„doFilter å¼€å¯è´£ä»»é“¾ï¼Œå³è°ƒç”¨ç¬¬ä¸€ä¸ªFilterçš„doFilterã€‚
4.æ¯ä¸ªFilter å¼€å§‹è¿è¡Œåï¼Œè®¾ç½®FilterChainæŒ‡å‘ä¸‹ä¸€ä¸ªFilterï¼Œå¤„ç†å®Œrequeståï¼Œè°ƒç”¨FiterChainæ‰§è¡Œä¸‹ä¸€ä¸ªFilterï¼Œåœ¨å¤„ç†responseã€‚ä¸‹ä¸€ä¸ªè¢«è°ƒç”¨çš„Filterä¹Ÿæ˜¯æŒ‰ç…§è¿™ä¸ªæ“ä½œï¼Œä¾¿å¯é€’å½’åœ°å¤„ç†å®Œrequestï¼Œå†ä»å†…åˆ°å¤–åœ°å¤„ç†responseï¼Œè¾¾åˆ°ååºå¤„ç†responseçš„æ•ˆæœã€‚

<!-- <center>
    <img src=".\imgs\5.2ã€Chain-of-responsibilityè´£ä»»é“¾æ¨¡å¼.md\image-20200314151151064.png"/>
</center> -->
![è´£ä»»é“¾/image-20200314151151064](https://jianxi-md-pics.oss-cn-beijing.aliyuncs.com/note-md-imgs/è´£ä»»é“¾/image-20200314151151064.png?x-oss-process=image/resize,p_100/sharpen,50)